\section{Setup}
\label{sec:setup}

The evaluation was performed on a 64-bit machine running Ubuntu 10.04 LTS. The machine featured a 3.0 Ghz Intel\textregistered Core\texttrademark 2 Duo processor and 4 Gb RAM. The version of LLVM used was 3.0, and Java was running on version 1.6.0\_26.

Program performance was tested on a variety of Java benchmarks, detailed in Section \ref{sec:benchmarks}. Each benchmark was compiled into 5 different versions: the original Java code, the translated LLVM bytecode, and three modules further-optimised by LLVM. 

The benchmarks were each compiled to a Dalvik executable file via the standard procedure; each program was written in Java with the Eclipse IDE, then exported as a .jar file. The \verb|dx| tool, as bundled with the Android SDK, was then used to convert the Java archive to the Dalvik executable format. At this point this file was translated into LLVM intermediate representation using the compiler documented in this report. This file was treated as the `baseline' file. 

In order to examine the effect LLVM's optimisation passes had on code performance, the compiled bytecode was further optimised using the LLVM \verb|opt| tool. In particular, three additional optimised bytecode files were produced by passing the bytecode file to LLVM's optimiser with one of the \verb|-O1|, \verb|-O2|, and \verb|-O3| flags. These three flags enable a predefined set of optimisations which increase in aggressiveness as the level increases: level 3 runs more aggressive optimisations than level 1 does, for example. The set of optimisations switched on by each level is not listed, however the documentation claims that they are roughly equivalent to the \verb|-O1|, \verb|-O2|, and \verb|-O3| optimisation flags offered by the GCC compiler\footnotemark \footnotetext[1]{http://llvm.org/cmds/opt.html}.

Each optimised LLVM module was additionally run with a base flag set of \verb|-mem2reg -std-compile-opts -std-link-opts|. The \verb|mem2reg| pass, as described earlier, promotes stack values and memory to registers, and is one of the vital optimisation passes the compiler relies upon. The \verb|std-compile-opts| flags activates a standard list of compile-time optimisation passes. The standard list of link-time optimisations is likewise given by the \verb|std-link-opts| flag. The latter two are especially useful in removing unused functions from the LLVM module.

However, each of the three optimised LLVM modules output identical code. They are therefore presented together in the results as there is no difference between them. The different optimisations resulted in identical code because the advanced optimisations offered by the \verb|-O2| and \verb|-O3| flags were not applicable on the relatively straight-forward benchmarks used in the evaluation.

Each version was then run 20 times and the runtimes were recorded. The mean value is given in order to smooth out anomalies encountered during execution. The time of day was taken before and after each benchmark was taken, and the difference of these two times was taken as the runtime, in milliseconds. Error bars detailing the minimum and maximum runtimes of each program are given in each Figure to demonstrate the wide fluctuations in runtime that occur during execution.
